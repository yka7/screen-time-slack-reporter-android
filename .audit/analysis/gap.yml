version: "1.0"
run_id: "audit-run-001"
updated_at: "2025-01-31T12:00:00Z"

# === ギャップ分析 ===
# Intent（intent.yml）と現状（as_is.yml）の乖離を検出

gaps:
  - id: "ISS-001"
    category: "security"
    severity: "medium"
    title: "Webhook URLが平文で保存されている"
    intent: "SEC-001: Webhook URLは秘匿情報として扱う"
    current: "Preferences DataStoreに平文保存（PreferencesDataStore.kt:72）"
    gap: "暗号化ストレージ（EncryptedSharedPreferences or Android Keystore）未使用"
    impact: "root化端末やバックアップ経由でWebhook URLが漏洩し、Slackチャンネルへの不正投稿が可能になる"
    assumption: "ASM-005"
    recommendation: "EncryptedSharedPreferencesまたはAndroid KeystoreでWebhook URLを暗号化保存"
    effort: "medium"
    risk: "暗号化ライブラリの追加による依存関係増加"
    note: "子ども端末のroot化リスクは低いため、優先度は中程度"

  - id: "ISS-002"
    category: "documentation"
    severity: "low"
    title: "スクリーンショットが未掲載"
    intent: "ユーザーがアプリの外観を事前確認できること"
    current: "README.md:15 に「TODO: アプリのスクリーンショットを追加」と記載"
    gap: "スクリーンショットが存在しない"
    impact: "初回利用者がアプリの外観を把握できない"
    recommendation: "主要画面（ホーム・設定・除外設定）のスクリーンショットを撮影しREADMEに追加"
    effort: "low"
    risk: "なし"

  - id: "ISS-003"
    category: "quality"
    severity: "medium"
    title: "テストカバレッジの実測値が未確認"
    intent: "QA-001: テストカバレッジ >= 80%"
    current: "JaCoCo設定済み、テストファイル27個存在。ただしAndroid SDK環境なしでは実測不可"
    gap: "カバレッジ目標（80%）に対する実測値が不明"
    impact: "品質基準の達成可否が判断できない"
    assumption: "ASM-002"
    recommendation: "Android SDK環境で ./gradlew jacocoTestReport を実行しカバレッジ実測値を確認"
    effort: "low"
    risk: "なし"

  - id: "ISS-004"
    category: "documentation"
    severity: "low"
    title: "CHANGELOG / リリースノートが存在しない"
    intent: "バージョン管理と変更履歴の追跡"
    current: "versionCode=1, versionName=1.0.0 だがCHANGELOGファイルなし"
    gap: "変更履歴が追跡できない"
    impact: "将来のバージョンアップ時に変更内容の把握が困難"
    recommendation: "CHANGELOG.md を作成し、セマンティックバージョニングに従って更新"
    effort: "low"
    risk: "なし"

  - id: "ISS-005"
    category: "quality"
    severity: "low"
    title: "Instrumented Test（UIテスト）が未実装"
    intent: "UI層の品質保証"
    current: "androidTest依存関係は定義済み（Espresso, Compose UI Test）だがテストファイルなし"
    gap: "Compose UI画面の自動テストが存在しない"
    impact: "UI回帰バグの検出が手動に依存"
    recommendation: "主要画面（ホーム・設定）のCompose UIテストを追加"
    effort: "high"
    risk: "エミュレータ/実機依存のテスト環境構築が必要"

  - id: "ISS-006"
    category: "usability"
    severity: "low"
    title: "目標利用時間がハードコードされている"
    intent: "保護者が子どもの利用時間を管理 → 目標時間は家庭ごとに異なる"
    current: "目標利用時間（30分）がSlackMessageBuilder.kt:23でハードコード"
    gap: "保護者が目標時間をカスタマイズできない"
    impact: "ユーザビリティの低下"
    recommendation: "AppSettingsにtargetMinutesフィールドを追加し、設定画面から変更可能にする"
    effort: "medium"
    risk: "なし"

  - id: "ISS-007"
    category: "operations"
    severity: "medium"
    title: "Worker失敗時のエラー通知が不足"
    intent: "ユーザー（保護者）がエラー発生時に適切な対処ができる"
    current: "DailySlackReportWorker.kt:49でUsage Access無効時にResult.failure()のみ返す"
    gap: "バックグラウンドでの失敗がユーザーに通知されない可能性"
    impact: "保護者がSlack通知の失敗に気づかない"
    recommendation: "Worker失敗時にAndroid通知で保護者にエラーを通知する仕組みを追加"
    effort: "medium"
    risk: "通知権限の追加が必要"

summary:
  total_gaps: 7
  critical: 0
  high: 0
  medium: 3
  low: 4
  overall_health: "Good"
  maturity_level: "初期リリース段階（v1.0.0）。基本機能・テスト・アーキテクチャは整備されている。セキュリティとドキュメントに改善余地あり"
  priority_path: "ISS-001（セキュリティ）→ ISS-003（カバレッジ）→ ISS-007（エラー通知）"
